!function(a,b,c,d,e){{var f=d.Model.extend({defaults:{itemId:"",buttons:'<button class="add-item item-object">+ {}</button><button class="add-item item-array">+ []</button><button class="add-item item-string">+ string</button><button class="add-item item-image">+ image</button>',type:"string",parentId:"0",parentType:"object",level:0,key:"",value:""},initialize:function(){this.get("itemId")?this.cid=this.get("itemId"):this.set({itemId:this.cid})}}),g=d.Collection.extend({model:f,comparator:"level"}),h=d.View.extend({tagName:"li",template:null,events:{"click span.delete":"remove","change input":"updateModel","click button.select-image":"selectImage"},initialize:function(){e.bindAll(this,"render","unrender","remove","updateModel","selectImage"),c(this.el).attr("id",this.model.get("itemId")),this.template=e.template(c("#"+this.model.get("parentType")+"-"+this.model.get("type")).html()),("string"===this.model.get("type")||"image"===this.model.get("type"))&&this.model.set({buttons:""}),this.model.bind("change",this.render),this.model.bind("remove",this.unrender),this.model.bind("updateModel",this.updateModel)},render:function(){return this.$el.html(this.template(this.model.toJSON())+this.model.get("buttons")),this},unrender:function(){c(this.el).remove()},remove:function(){e(this.model.collection.where({parentId:this.model.get("itemId")})).each(function(){this.unrender(),this.model.collection.remove(this.model)},this),this.model.collection.remove(this.model)},selectImage:function(a){a.preventDefault();var b=this,c=wp.media();c.on("select",function(){var a=c.state().get("selection"),d=[];a.each(function(a){d.push(a.attributes)}),b.model.set({value:d})}),c.open()},updateModel:function(){switch(this.model.get("type")){case"string":case"object":case"array":this.model.set({key:this.$el.find("input.key").val(),value:this.$el.find("input.value").val()});break;case"image":this.model.set({key:this.$el.find("input.key").val()})}}}),i=d.View.extend({el:c("#content-json-editor"),events:{"click button.add-item":"addItem"},initialize:function(){e.bindAll(this,"render","addItem","appendItem","updateContent"),this.collection=c("#content").val()?new g(JSON.parse(c("#content").val())):new g,this.collection.bind("add",this.appendItem),this.collection.bind("change reset add remove",this.updateContent),this.render()},render:function(){var a=this;c(this.el).append('<button class="add-item item-object">+ {}</button><button class="add-item item-array">+ []</button><button class="add-item item-string">+ string</button><button class="add-item item-image">+ image</button>'),c(this.el).append("<ul></ul>"),e(this.collection.models).each(function(b){a.appendItem(b)},this)},addItem:function(a){a.preventDefault();var b="LI"===a.target.parentElement.tagName?this.collection.findWhere({itemId:a.target.parentElement.id}):!1,c=new f({type:a.target.className.match(/item-([^\s]+)/)[1],parentId:b?b.get("itemId"):"0",parentType:b?b.get("type"):"object",level:b?b.get("level")+1:0});this.collection.add(c)},appendItem:function(a){var b=new h({model:a});"0"!==a.get("parentId")?c("#"+a.get("parentId")+">ul, #"+a.get("parentId")+">ol").append(b.render().el):c("ul",this.el).append(b.render().el)},updateContent:function(){c("#content").val(JSON.stringify(this.collection))}});new i}}(this,document,jQuery,Backbone,_);