!function(a,b,c,d,e){{var f=d.Model.extend({defaults:{itemId:"",buttons:["object","array","string","color","map","tinymce","image"],type:"string",parentId:"0",parentType:"object",level:0,order:0,key:"",value:""},initialize:function(){this.get("itemId")?this.cid=this.get("itemId"):this.set({itemId:this.cid})}}),g=d.Collection.extend({model:f,comparator:function(a){return[a.get("level"),a.get("order")]}}),h=d.View.extend({tagName:"li",template:null,events:{"click span.delete":"remove","change input":"updateModel","click button.select-image":"selectImage"},initialize:function(){e.bindAll(this,"render","unrender","removeTree","remove","updateModel","selectImage","updateOrder"),c(this.el).attr("id",this.model.get("itemId")),this.template=e.template(c("#"+this.model.get("parentType")+"-"+this.model.get("type")).html()),("string"===this.model.get("type")||"tinymce"===this.model.get("type")||"image"===this.model.get("type")||"color"===this.model.get("type")||"map"===this.model.get("type"))&&this.model.set({buttons:[]}),this.buttons=this.getButtonsHtml(this.model.get("buttons")),this.model.bind("remove",this.unrender),this.model.bind("updateModel",this.updateModel)},getButtonsHtml:function(a){var b="";return e(a).each(function(a){b+=c("#button-add-"+a).html()}),b?'<span class="plus-icon"></span>'+b:b},render:function(){var a=this;return this.$el.html(this.template(this.model.toJSON())+this.buttons),this.$el.children("ul, ol").sortable({update:function(){a.updateOrder()},stop:function(){a.$el.find("textarea").each(function(){var a=c(this);a.hasClass("wp-editor-area")&&tinyMCE.execCommand("mceAddEditor",!0,a.attr("id"))})},start:function(){a.$el.find("textarea").each(function(){var a=c(this),b="";a.hasClass("wp-editor-area")&&(b=tinyMCE.activeEditor.getContent(),tinyMCE.execCommand("mceRemoveEditor",!1,a.attr("id")),a.val(b))})},handle:".sort-handle"}),this},unrender:function(){c(this.el).remove()},updateOrder:function(){e(this.model.collection.models).each(function(a){a.set({order:c("li#"+a.get("itemId")).index()})},this)},removeTree:function(a){e(a.collection.where({parentId:a.get("itemId")})).each(function(a){this.removeTree(a)},this),a.destroy()},remove:function(){this.removeTree(this.model)},selectImage:function(a){a.preventDefault(),a.stopPropagation();var b=this,c=wp.media();c.on("select",function(){var a=c.state().get("selection"),d=[];a.each(function(a){d.push(a.attributes)}),b.model.set({value:d}),b.$el.find(".image-preview").attr("src",d[0].sizes.thumbnail.url)}),c.open()},updateModel:function(){switch(this.model.get("type")){case"string":case"object":case"array":this.model.set({key:this.$el.find(".key").val(),value:this.$el.find(".value").val()});break;case"image":case"color":case"map":case"tinymce":this.model.set({key:this.$el.find(".key").val()})}}}),i=d.View.extend({el:c("#content-json-editor"),events:{"click button.add-item":"addItem"},initialize:function(){e.bindAll(this,"render","addItem","appendItem","updateContent","updateOrder");var a=this;this.collection=c("#content").val()?new g(JSON.parse(c("#content").val())):new g,this.collection.bind("add",this.appendItem),this.collection.bind("change reset add remove",this.updateContent),this.render(),this.$el.children("ul, ol").sortable({update:function(){a.updateOrder()},stop:function(){a.$el.find("textarea").each(function(){var a=c(this);a.hasClass("wp-editor-area")&&tinyMCE.execCommand("mceAddEditor",!0,a.attr("id"))})},start:function(){a.$el.find("textarea").each(function(){var a=c(this),b="";a.hasClass("wp-editor-area")&&(b=tinyMCE.activeEditor.getContent(),tinyMCE.execCommand("mceRemoveEditor",!1,a.attr("id")),a.val(b))})},handle:".sort-handle"})},render:function(){var a=this;c(this.el).append(this.getButtonsHtml(Object.getPrototypeOf(this.collection).model.prototype.defaults.buttons)),c(this.el).append("<ul></ul>"),e(this.collection.models).each(function(b){a.appendItem(b)},this)},getButtonsHtml:function(a){var b="";return e(a).each(function(a){b+=c("#button-add-"+a).html()}),b?'<span class="plus-icon"></span>'+b:b},addItem:function(a){a.preventDefault();var b="LI"===a.target.parentElement.tagName?this.collection.findWhere({itemId:a.target.parentElement.id}):!1,c=new f({type:a.target.className.match(/item-([^\s]+)/)[1],parentId:b?b.get("itemId"):"0",parentType:b?b.get("type"):"object",level:b?b.get("level")+1:0});this.collection.add(c)},appendItem:function(b){var d=new h({model:b}),e=null,f=null,g=null;if("0"!==b.get("parentId")?c("#"+b.get("parentId")+">ul, #"+b.get("parentId")+">ol").append(d.render().el):this.$el.children("ul").append(d.render().el),b.set({order:d.$el.index()}),d.$el.find(".color-picker").wpColorPicker({change:function(a,c){b.set({value:c.color.toString()})}}),d.$el.find("div.map").hasClass("map")&&(g=d.$el.find("div.map").attr("data-latLng")?d.$el.find("div.map").attr("data-latLng").replace(/[()]/g,"").split(", "):"44.97022530459223, -93.289053440094".split(", "),e=new google.maps.Map(d.$el.find("div.map")[0],{center:new google.maps.LatLng(g[0],g[1]),mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:10}),f=new google.maps.Marker({position:new google.maps.LatLng(g[0],g[1]),map:e,draggable:!0}),google.maps.event.addListener(f,"dragend",function(){b.set({value:f.getPosition().toString()})},!1)),d.$el.find("textarea").hasClass("wp-editor-area")){if("undefined"!=typeof tinymce)try{tinyMCE.init({theme:"modern",skin:"lightgray",language:"en",resize:"vertical",formats:{alignleft:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"left"}},{selector:"img,table,dl.wp-caption",classes:"alignleft"}],aligncenter:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"center"}},{selector:"img,table,dl.wp-caption",classes:"aligncenter"}],alignright:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"right"}},{selector:"img,table,dl.wp-caption",classes:"alignright"}],strikethrough:{inline:"del"}},relative_urls:!1,remove_script_host:!1,convert_urls:!1,browser_spellcheck:!0,fix_list_elements:!0,entities:"38,amp,60,lt,62,gt",entity_encoding:"raw",menubar:!1,keep_styles:!1,paste_remove_styles:!0,preview_styles:"font-family font-size font-weight font-style text-decoration text-transform",wpeditimage_disable_captions:!1,plugins:"charmap,hr,media,paste,tabfocus,textcolor,fullscreen,wordpress,wpeditimage,wpgallery,wplink,wpdialogs,wpview",content_css:"http://localhost/Wordpress-Development/api/wp-includes/css/dashicons.min.css?ver=3.9-beta2,http://localhost/Wordpress-Development/api/wp-includes/js/mediaelement/mediaelementplayer.min.css?ver=3.9-beta2,http://localhost/Wordpress-Development/api/wp-includes/js/mediaelement/wp-mediaelement.css?ver=3.9-beta2,http://localhost/Wordpress-Development/api/wp-includes/js/tinymce/skins/wordpress/wp-content.css?ver=3.9-beta2",selector:"#"+b.get("itemId")+"-tinymce",wpautop:!0,indent:!1,toolbar1:"bold,italic,strikethrough,bullist,numlist,blockquote,hr,alignleft,aligncenter,alignright,link,unlink,wp_more,spellchecker,fullscreen,wp_adv",toolbar2:"formatselect,underline,alignjustify,forecolor,pastetext,removeformat,charmap,outdent,indent,undo,redo,wp_help",toolbar3:"",toolbar4:"",tabfocus_elements:":prev,:next",body_class:b.get("itemId")+"-tinymce",elements:"none",setup:function(a){a.on("change",function(){b.set({value:a.getContent()})})}}),a.wpActiveEditor||(a.wpActiveEditor=b.get("itemId")+"-tinymce")}catch(i){}if("undefined"!=typeof quicktags)try{quicktags({id:b.get("itemId")+"-tinymce",buttons:"strong,em,link,block,del,ins,img,ul,ol,li,code,more,close"}),a.wpActiveEditor||(a.wpActiveEditor=b.get("itemId")+"-tinymce")}catch(i){}"undefined"!=typeof jQuery&&jQuery(".wp-editor-wrap").on("click.wp-editor",function(){this.id&&(a.wpActiveEditor=this.id.slice(3,-5))})}},updateOrder:function(){e(this.collection.models).each(function(a){a.set({order:c("li#"+a.get("itemId")).index()})},this)},updateContent:function(){this.collection.sort(),c("#content").val(JSON.stringify(this.collection))}});new i}}(this,document,jQuery,Backbone,_);